# gdiskコマンド
## gdiskとは
gdisk（GPT fdisk）は、GPT（GUID Partition Table）形式のディスクパーティションを管理するためのコマンドラインユーティリティです。fdiskと操作感は似ていますが、GPTパーティションテーブルに特化した機能を提供します。

## 基本的な使い方
```bash
sudo gdisk デバイス名
```

例：
```bash
sudo gdisk /dev/sda
```

> **注意**: gdiskの実行には通常root権限が必要です。

## 主なオプション

| オプション | 説明                                          |
| ----- | ------------------------------------------- |
| `-l`  | パーティションテーブルを表示するのみ（読み取り専用モード）, 空きセクターも確認できる |
| `-o`  | 出力フォーマットの指定（例: -o machine）                  |
| `-b`  | MBRをファイルにバックアップ                             |
| `-e`  | 拡張モードで実行（非推奨）                               |
| `-v`  | バージョン情報を表示                                  |
| `-z`  | ディスクのGPTデータを破棄して初期化                         |

## 対話モードのサブコマンド

gdiskを実行すると対話モードになり、以下のサブコマンドが使用できます：

| コマンド        | 説明                              |
| ----------- | ------------------------------- |
| `?` または `m` | ヘルプメニューを表示                      |
| `p`         | 現在のパーティションテーブルを表示, 空きセクターも確認できる |
| `o`         | 新しいGPTパーティションテーブルを作成            |
| `n`         | 新しいパーティションを作成                   |
| `d`         | パーティションを削除                      |
| `i`         | パーティションの詳細情報を表示                 |
| `l`         | パーティションタイプコードの一覧を表示             |
| `t`         | パーティションのタイプコードを変更               |
| `c`         | パーティション名を変更（GPT固有機能）            |
| `u`         | パーティションのUUIDを変更（GPT固有機能）        |
| `v`         | パーティションテーブルを検証                  |
| `z`         | GPTデータを破棄してディスクを初期化             |
| `r`         | リカバリと変換メニュー（MBR⇔GPT変換など）        |
| `w`         | パーティションテーブルを書き込んで終了（変更を保存）      |
| `q`         | 変更を保存せずに終了                      |

## 特殊機能（rコマンドによるリカバリと変換オプション）

| サブコマンド | 説明 |
|--------------|------|
| `r` → `h` | MBRからGPTへ変換 |
| `r` → `g` | GPTからMBRへ変換 |
| `r` → `b` | GPTバックアップから主GPTを復元 |
| `r` → `e` | GPTヘッダを再作成 |

## 一般的な使用例

1. **パーティションテーブルの表示**
   ```bash
   sudo gdisk -l /dev/sda
   ```

2. **新しいGPTパーティションの作成プロセス**
   ```bash
   sudo gdisk /dev/sda
   # o を入力して新しいGPTパーティションテーブルを作成（データは消去される）
   # n を入力して新しいパーティション
   # パーティション番号を入力（Enter でデフォルト）
   # 開始セクタを入力（Enter でデフォルト）
   # 終了セクタまたはサイズを入力（例：+500M）
   # パーティションタイプを入力（Enter でデフォルト）
   # w を入力して保存
   ```

3. **パーティション名の設定（GPT固有機能）**
   ```bash
   sudo gdisk /dev/sda
   # c を入力
   # パーティション番号を入力
   # 名前を入力
   # w を入力して保存
   ```

4. **MBRからGPTへの変換**
   ```bash
   sudo gdisk /dev/sda
   # r を入力してリカバリ/変換メニューに入る
   # h を入力してMBRからGPTへ変換
   # w を入力して保存
   ```

## fdiskとの主な違い

| 機能 | gdisk | fdisk |
|------|-------|-------|
| 対応パーティションテーブル | 主にGPT | 主にMBR（新バージョンはGPTも対応） |
| パーティション数制限 | 128個（デフォルト） | MBRでは4個（基本）+拡張内に論理パーティション |
| パーティション名設定 | 可能 | 不可 |
| パーティションUUID管理 | 可能 | 不可 |
| 最大ディスクサイズ | 18EiB（理論上） | MBRでは2TiB |
| MBR⇔GPT変換 | 内蔵機能あり | なし |

> **重要**: GPTディスクへの変更は、ディスク上のデータを失う可能性があります。重要なデータは事前にバックアップしておくことを強く推奨します。